---

title: Inference 


keywords: fastai
sidebar: home_sidebar

summary: "The objective that we want to achieve is to establish the right playbooks that would help us in"
description: "The objective that we want to achieve is to establish the right playbooks that would help us in"
nb_path: "2_Inference.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 2_Inference.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Imports">Imports<a class="anchor-link" href="#Imports"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">sagemaker</span>
<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">sagemaker</span> <span class="kn">import</span> <span class="n">get_execution_role</span>
<span class="kn">from</span> <span class="nn">sagemaker.spark.processing</span> <span class="kn">import</span> <span class="n">PySparkProcessor</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">Namespace</span><span class="p">,</span> <span class="n">ArgumentParser</span>

<span class="c1"># to get the latest sagemaker python sdk</span>
<span class="c1">#!pip install -U sagemaker</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Clients">Clients<a class="anchor-link" href="#Clients"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">role</span> <span class="o">=</span> <span class="n">get_execution_role</span><span class="p">()</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="s1">&#39;sagemaker&#39;</span><span class="p">)</span>
<span class="n">smfs_runtime</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="s1">&#39;sagemaker-featurestore-runtime&#39;</span><span class="p">)</span>

<span class="n">s3_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
<span class="n">cf_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">)</span>
<span class="n">kinesis_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;kinesis&#39;</span><span class="p">)</span>
<span class="n">lambda_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;lambda&#39;</span><span class="p">)</span>
<span class="n">kda_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;kinesisanalytics&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="S3_DATA-lOCATION-(For-Testing-the-Streaming)">S3_DATA lOCATION (For Testing the Streaming)<a class="anchor-link" href="#S3_DATA-lOCATION-(For-Testing-the-Streaming)"> </a></h5>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s3_bucket</span> <span class="o">=</span> <span class="n">sagemaker</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">default_bucket</span><span class="p">()</span>
<span class="n">s3_transformed_data_prefix</span> <span class="o">=</span> <span class="s1">&#39;heidelberg/data&#39;</span>
<span class="n">s3_transformed_data_filename</span> <span class="o">=</span> <span class="s2">&quot;transformed.csv&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Test-out-the-solution,-end-to-end">Test out the solution, end to end<a class="anchor-link" href="#Test-out-the-solution,-end-to-end"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Utility-functions">Utility functions<a class="anchor-link" href="#Utility-functions"> </a></h3><ol>
<li><p>To show the results on CLoudwatch Urls( <a href="https://console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Flambda$252FHeidelbergInvokeFraudEndpointLambda3">https://console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Flambda$252FHeidelbergInvokeFraudEndpointLambda3</a> )</p>
</li>
<li><p>Putting the incoming data in stream</p>
</li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">store</span> -r
<span class="k">def</span> <span class="nf">get_cloudwatch_logs_url</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">):</span>
    <span class="n">log_group_name</span> <span class="o">=</span> <span class="s1">&#39;/aws/lambda/&#39;</span> <span class="o">+</span> <span class="n">predict_lambda_name</span> 
    <span class="c1"># get the latest log stream for our Lambda that makes fraud predictions</span>
    <span class="n">cw_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;logs&#39;</span><span class="p">)</span>
    <span class="n">last_cw_evt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">last_cw_evt</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_test_time</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">):</span>
        <span class="n">streams</span> <span class="o">=</span> <span class="n">cw_client</span><span class="o">.</span><span class="n">describe_log_streams</span><span class="p">(</span><span class="n">logGroupName</span><span class="o">=</span><span class="n">log_group_name</span><span class="p">,</span>
                                                 <span class="n">orderBy</span><span class="o">=</span><span class="s1">&#39;LastEventTime&#39;</span><span class="p">,</span>
                                                 <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;logStreams&#39;</span><span class="p">]</span>
        <span class="n">last_cw_evt</span> <span class="o">=</span> <span class="n">streams</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;lastIngestionTime&#39;</span><span class="p">]</span> <span class="c1">#&#39;lastEventTimestamp&#39;]</span>
        <span class="n">latest_stream</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">streams</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;logStreamName&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;$252F&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[$LATEST]&#39;</span><span class="p">,</span> <span class="s1">&#39;$255B$2524LATEST$255D&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">last_cw_evt</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_test_time</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;waiting for updated log stream...&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># produce a valid URL to get to that log stream</span>
    <span class="n">region</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">region_name</span>
    <span class="n">log_group_escaped</span> <span class="o">=</span> <span class="n">log_group_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;$252F&#39;</span><span class="p">)</span>
    <span class="n">cw_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://console.aws.amazon.com/cloudwatch/home?region=</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s1">#logsV2:log-groups/log-group/</span><span class="si">{</span><span class="n">log_group_escaped</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">time_filter</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;$26start$3D</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">start_test_time</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10000</span><span class="si">}</span><span class="s1">$26end$3D</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">end_test_time</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="mi">40000</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">full_cw_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cw_url</span><span class="si">}</span><span class="s1">/log-events/</span><span class="si">{</span><span class="n">latest_stream</span><span class="si">}</span><span class="s1">$3FfilterPattern$3DPrediction+</span><span class="si">{</span><span class="n">time_filter</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Updated log stream is ready.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">full_cw_url</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">store</span> -r
<span class="k">def</span> <span class="nf">put_to_stream</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">):</span>
    <span class="n">ret_status</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sending a new payload: &#39;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">kinesis_client</span><span class="o">.</span><span class="n">put_record</span><span class="p">(</span><span class="n">StreamName</span> <span class="o">=</span> <span class="n">STREAM_NAME</span> <span class="p">,</span>
                                             <span class="n">Data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
                                             <span class="n">PartitionKey</span> <span class="o">=</span> <span class="s1">&#39;shard1&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;ResponseMetadata&#39;</span><span class="p">][</span><span class="s1">&#39;HTTPStatusCode&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Kinesis put_record failed: </span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response</span><span class="p">)))</span>
        <span class="n">ret_status</span> <span class="o">=</span> <span class="kc">False</span>
        
    <span class="k">return</span> <span class="n">ret_status</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Send-some-payloads,-and-see-the-results-(Testing-purpose)">Send some payloads, and see the results (Testing purpose)<a class="anchor-link" href="#Send-some-payloads,-and-see-the-results-(Testing-purpose)"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">io</span>

<span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">s3_bucket</span><span class="p">,</span><span class="n">s3_transformed_data_prefix</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">s3_transformed_data_filename</span> <span class="p">)</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="s1">&#39;Body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">body</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Expected Outputs&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">index</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
        <span class="k">break</span>

<span class="k">del</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>
<span class="n">payloads</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">payloads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">index</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
        <span class="k">break</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Expected Outputs
2.23
2.63
2.29
1.97
1.12
1.26
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="n">start_test_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> 

<span class="k">for</span> <span class="n">payload</span> <span class="ow">in</span> <span class="n">payloads</span><span class="p">:</span>
    <span class="n">put_to_stream</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

<span class="n">end_test_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> 
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Sending a new payload: 
Sending a new payload: 
Sending a new payload: 
Sending a new payload: 
Sending a new payload: 
Sending a new payload: 
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Results-of-above-test">Results of above test<a class="anchor-link" href="#Results-of-above-test"> </a></h3><p>The following cell dynamically creates a link to view the results. It waits for the CloudWatch log stream to have the output events from the transactions we just sent. The URL also hones in on the output from the specific timeframe of the transactions.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>

<span class="n">full_cw_url</span> <span class="o">=</span> <span class="n">get_cloudwatch_logs_url</span><span class="p">(</span><span class="n">start_test_time</span><span class="p">,</span> <span class="n">end_test_time</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;b&gt;Review results in this log stream &lt;a target=&quot;blank&quot; href=&quot;</span><span class="si">{</span><span class="n">full_cw_url</span><span class="si">}</span><span class="s1">&quot;&gt;Lambda fraud detection results&lt;/a&gt;&lt;/b&gt;&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>waiting for updated log stream...
Updated log stream is ready.
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<b>Review results in this log stream <a target="blank" href="https://console.aws.amazon.com/cloudwatch/home?region=us-east-1#logsV2:log-groups/log-group/$252Faws$252Flambda$252FHeidelbergInvokeFraudEndpointLambda3/log-events/2021$252F01$252F05$252F$255B$2524LATEST$255Db0da2a958fcb469fbd56f66761427ec5$3FfilterPattern$3DPrediction+$26start$3D1609865298678$26end$3D1609865348787">Lambda fraud detection results</a></b>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="(OPTIONAL)-Feed-a-stream-of-transactions-from-API">(OPTIONAL) Feed a stream of transactions from API<a class="anchor-link" href="#(OPTIONAL)-Feed-a-stream-of-transactions-from-API"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># This code need to run for whole time, so we will put this code in a pipeline</span>
<span class="k">def</span> <span class="nf">callAPI</span><span class="p">():</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">api_data</span> <span class="o">=</span> <span class="n">get_data_from_api</span><span class="p">()</span>
        <span class="n">api_trasformed_data</span> <span class="o">=</span> <span class="n">get_trasformed_data</span><span class="p">(</span><span class="n">api_data</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">put_to_stream</span><span class="p">(</span><span class="n">api_transformed_data</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">status</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error found during write to Kinesis Stream&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
  
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

