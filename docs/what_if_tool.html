---

title: What_if_tool


keywords: fastai
sidebar: home_sidebar



nb_path: "4_what_if_tool.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 4_what_if_tool.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>pip install witwidget
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Requirement already satisfied: witwidget in /opt/conda/lib/python3.7/site-packages (1.7.0)
Requirement already satisfied: six&gt;=1.12.0 in /opt/conda/lib/python3.7/site-packages (from witwidget) (1.14.0)
Requirement already satisfied: tensorflow&gt;=1.12.1 in /opt/conda/lib/python3.7/site-packages (from witwidget) (2.4.0)
Requirement already satisfied: oauth2client&gt;=4.1.3 in /opt/conda/lib/python3.7/site-packages (from witwidget) (4.1.3)
Requirement already satisfied: jupyter&lt;2,&gt;=1.0 in /opt/conda/lib/python3.7/site-packages (from witwidget) (1.0.0)
Requirement already satisfied: absl-py&gt;=0.4 in /opt/conda/lib/python3.7/site-packages (from witwidget) (0.11.0)
Requirement already satisfied: google-api-python-client&gt;=1.7.8 in /opt/conda/lib/python3.7/site-packages (from witwidget) (1.12.8)
Requirement already satisfied: ipywidgets&gt;=7.0.0 in /opt/conda/lib/python3.7/site-packages (from witwidget) (7.5.1)
Requirement already satisfied: termcolor~=1.1.0 in /opt/conda/lib/python3.7/site-packages (from tensorflow&gt;=1.12.1-&gt;witwidget) (1.1.0)
Requirement already satisfied: flatbuffers~=1.12.0 in /opt/conda/lib/python3.7/site-packages (from tensorflow&gt;=1.12.1-&gt;witwidget) (1.12)
Requirement already satisfied: typing-extensions~=3.7.4 in /opt/conda/lib/python3.7/site-packages (from tensorflow&gt;=1.12.1-&gt;witwidget) (3.7.4.3)
Requirement already satisfied: google-pasta~=0.2 in /opt/conda/lib/python3.7/site-packages (from tensorflow&gt;=1.12.1-&gt;witwidget) (0.2.0)
Requirement already satisfied: numpy~=1.19.2 in /opt/conda/lib/python3.7/site-packages (from tensorflow&gt;=1.12.1-&gt;witwidget) (1.19.4)
Requirement already satisfied: wheel~=0.35 in /opt/conda/lib/python3.7/site-packages (from tensorflow&gt;=1.12.1-&gt;witwidget) (0.36.2)
Requirement already satisfied: gast==0.3.3 in /opt/conda/lib/python3.7/site-packages (from tensorflow&gt;=1.12.1-&gt;witwidget) (0.3.3)
Requirement already satisfied: astunparse~=1.6.3 in /opt/conda/lib/python3.7/site-packages (from tensorflow&gt;=1.12.1-&gt;witwidget) (1.6.3)
Requirement already satisfied: tensorflow-estimator&lt;2.5.0,&gt;=2.4.0rc0 in /opt/conda/lib/python3.7/site-packages (from tensorflow&gt;=1.12.1-&gt;witwidget) (2.4.0)
Requirement already satisfied: wrapt~=1.12.1 in /opt/conda/lib/python3.7/site-packages (from tensorflow&gt;=1.12.1-&gt;witwidget) (1.12.1)
Requirement already satisfied: keras-preprocessing~=1.1.2 in /opt/conda/lib/python3.7/site-packages (from tensorflow&gt;=1.12.1-&gt;witwidget) (1.1.2)
Requirement already satisfied: tensorboard~=2.4 in /opt/conda/lib/python3.7/site-packages (from tensorflow&gt;=1.12.1-&gt;witwidget) (2.4.0)
Requirement already satisfied: grpcio~=1.32.0 in /opt/conda/lib/python3.7/site-packages (from tensorflow&gt;=1.12.1-&gt;witwidget) (1.32.0)
Requirement already satisfied: h5py~=2.10.0 in /opt/conda/lib/python3.7/site-packages (from tensorflow&gt;=1.12.1-&gt;witwidget) (2.10.0)
Requirement already satisfied: protobuf&gt;=3.9.2 in /opt/conda/lib/python3.7/site-packages (from tensorflow&gt;=1.12.1-&gt;witwidget) (3.14.0)
Requirement already satisfied: opt-einsum~=3.3.0 in /opt/conda/lib/python3.7/site-packages (from tensorflow&gt;=1.12.1-&gt;witwidget) (3.3.0)
Requirement already satisfied: pyasn1-modules&gt;=0.0.5 in /opt/conda/lib/python3.7/site-packages (from oauth2client&gt;=4.1.3-&gt;witwidget) (0.2.8)
Requirement already satisfied: httplib2&gt;=0.9.1 in /opt/conda/lib/python3.7/site-packages (from oauth2client&gt;=4.1.3-&gt;witwidget) (0.18.1)
Requirement already satisfied: rsa&gt;=3.1.4 in /opt/conda/lib/python3.7/site-packages (from oauth2client&gt;=4.1.3-&gt;witwidget) (4.5)
Requirement already satisfied: pyasn1&gt;=0.1.7 in /opt/conda/lib/python3.7/site-packages (from oauth2client&gt;=4.1.3-&gt;witwidget) (0.4.8)
Requirement already satisfied: qtconsole in /opt/conda/lib/python3.7/site-packages (from jupyter&lt;2,&gt;=1.0-&gt;witwidget) (4.6.0)
Requirement already satisfied: nbconvert in /opt/conda/lib/python3.7/site-packages (from jupyter&lt;2,&gt;=1.0-&gt;witwidget) (5.6.1)
Requirement already satisfied: notebook in /opt/conda/lib/python3.7/site-packages (from jupyter&lt;2,&gt;=1.0-&gt;witwidget) (6.0.3)
Requirement already satisfied: ipykernel in /opt/conda/lib/python3.7/site-packages (from jupyter&lt;2,&gt;=1.0-&gt;witwidget) (5.1.4)
Requirement already satisfied: jupyter-console in /opt/conda/lib/python3.7/site-packages (from jupyter&lt;2,&gt;=1.0-&gt;witwidget) (6.1.0)
Requirement already satisfied: google-auth-httplib2&gt;=0.0.3 in /opt/conda/lib/python3.7/site-packages (from google-api-python-client&gt;=1.7.8-&gt;witwidget) (0.0.4)
Requirement already satisfied: google-auth&gt;=1.16.0 in /opt/conda/lib/python3.7/site-packages (from google-api-python-client&gt;=1.7.8-&gt;witwidget) (1.24.0)
Requirement already satisfied: uritemplate&lt;4dev,&gt;=3.0.0 in /opt/conda/lib/python3.7/site-packages (from google-api-python-client&gt;=1.7.8-&gt;witwidget) (3.0.1)
Requirement already satisfied: google-api-core&lt;2dev,&gt;=1.21.0 in /opt/conda/lib/python3.7/site-packages (from google-api-python-client&gt;=1.7.8-&gt;witwidget) (1.24.1)
Requirement already satisfied: nbformat&gt;=4.2.0 in /opt/conda/lib/python3.7/site-packages (from ipywidgets&gt;=7.0.0-&gt;witwidget) (5.0.4)
Requirement already satisfied: ipython&gt;=4.0.0; python_version &gt;= &#34;3.3&#34; in /opt/conda/lib/python3.7/site-packages (from ipywidgets&gt;=7.0.0-&gt;witwidget) (7.12.0)
Requirement already satisfied: widgetsnbextension~=3.5.0 in /opt/conda/lib/python3.7/site-packages (from ipywidgets&gt;=7.0.0-&gt;witwidget) (3.5.1)
Requirement already satisfied: traitlets&gt;=4.3.1 in /opt/conda/lib/python3.7/site-packages (from ipywidgets&gt;=7.0.0-&gt;witwidget) (4.3.3)
Requirement already satisfied: werkzeug&gt;=0.11.15 in /opt/conda/lib/python3.7/site-packages (from tensorboard~=2.4-&gt;tensorflow&gt;=1.12.1-&gt;witwidget) (1.0.0)
Requirement already satisfied: tensorboard-plugin-wit&gt;=1.6.0 in /opt/conda/lib/python3.7/site-packages (from tensorboard~=2.4-&gt;tensorflow&gt;=1.12.1-&gt;witwidget) (1.7.0)
Requirement already satisfied: markdown&gt;=2.6.8 in /opt/conda/lib/python3.7/site-packages (from tensorboard~=2.4-&gt;tensorflow&gt;=1.12.1-&gt;witwidget) (3.3.3)
Requirement already satisfied: setuptools&gt;=41.0.0 in /opt/conda/lib/python3.7/site-packages (from tensorboard~=2.4-&gt;tensorflow&gt;=1.12.1-&gt;witwidget) (45.2.0.post20200210)
Requirement already satisfied: requests&lt;3,&gt;=2.21.0 in /opt/conda/lib/python3.7/site-packages (from tensorboard~=2.4-&gt;tensorflow&gt;=1.12.1-&gt;witwidget) (2.22.0)
Requirement already satisfied: google-auth-oauthlib&lt;0.5,&gt;=0.4.1 in /opt/conda/lib/python3.7/site-packages (from tensorboard~=2.4-&gt;tensorflow&gt;=1.12.1-&gt;witwidget) (0.4.2)
Requirement already satisfied: jupyter-client&gt;=4.1 in /opt/conda/lib/python3.7/site-packages (from qtconsole-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (5.3.4)
Requirement already satisfied: ipython-genutils in /opt/conda/lib/python3.7/site-packages (from qtconsole-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (0.2.0)
Requirement already satisfied: jupyter-core in /opt/conda/lib/python3.7/site-packages (from qtconsole-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (4.6.1)
Requirement already satisfied: pygments in /opt/conda/lib/python3.7/site-packages (from qtconsole-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (2.5.2)
Requirement already satisfied: testpath in /opt/conda/lib/python3.7/site-packages (from nbconvert-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (0.4.4)
Requirement already satisfied: bleach in /opt/conda/lib/python3.7/site-packages (from nbconvert-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (3.1.0)
Requirement already satisfied: entrypoints&gt;=0.2.2 in /opt/conda/lib/python3.7/site-packages (from nbconvert-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (0.3)
Requirement already satisfied: jinja2&gt;=2.4 in /opt/conda/lib/python3.7/site-packages (from nbconvert-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (2.11.1)
Requirement already satisfied: mistune&lt;2,&gt;=0.8.1 in /opt/conda/lib/python3.7/site-packages (from nbconvert-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (0.8.4)
Requirement already satisfied: pandocfilters&gt;=1.4.1 in /opt/conda/lib/python3.7/site-packages (from nbconvert-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (1.4.2)
Requirement already satisfied: defusedxml in /opt/conda/lib/python3.7/site-packages (from nbconvert-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (0.6.0)
Requirement already satisfied: Send2Trash in /opt/conda/lib/python3.7/site-packages (from notebook-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (1.5.0)
Requirement already satisfied: tornado&gt;=5.0 in /opt/conda/lib/python3.7/site-packages (from notebook-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (6.0.3)
Requirement already satisfied: pyzmq&gt;=17 in /opt/conda/lib/python3.7/site-packages (from notebook-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (18.1.1)
Requirement already satisfied: terminado&gt;=0.8.1 in /opt/conda/lib/python3.7/site-packages (from notebook-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (0.8.3)
Requirement already satisfied: prometheus-client in /opt/conda/lib/python3.7/site-packages (from notebook-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (0.7.1)
Requirement already satisfied: prompt-toolkit!=3.0.0,!=3.0.1,&lt;3.1.0,&gt;=2.0.0 in /opt/conda/lib/python3.7/site-packages (from jupyter-console-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (3.0.3)
Requirement already satisfied: cachetools&lt;5.0,&gt;=2.0.0 in /opt/conda/lib/python3.7/site-packages (from google-auth&gt;=1.16.0-&gt;google-api-python-client&gt;=1.7.8-&gt;witwidget) (4.2.0)
Requirement already satisfied: googleapis-common-protos&lt;2.0dev,&gt;=1.6.0 in /opt/conda/lib/python3.7/site-packages (from google-api-core&lt;2dev,&gt;=1.21.0-&gt;google-api-python-client&gt;=1.7.8-&gt;witwidget) (1.52.0)
Requirement already satisfied: pytz in /opt/conda/lib/python3.7/site-packages (from google-api-core&lt;2dev,&gt;=1.21.0-&gt;google-api-python-client&gt;=1.7.8-&gt;witwidget) (2019.3)
Requirement already satisfied: jsonschema!=2.5.0,&gt;=2.4 in /opt/conda/lib/python3.7/site-packages (from nbformat&gt;=4.2.0-&gt;ipywidgets&gt;=7.0.0-&gt;witwidget) (3.2.0)
Requirement already satisfied: pexpect; sys_platform != &#34;win32&#34; in /opt/conda/lib/python3.7/site-packages (from ipython&gt;=4.0.0; python_version &gt;= &#34;3.3&#34;-&gt;ipywidgets&gt;=7.0.0-&gt;witwidget) (4.8.0)
Requirement already satisfied: decorator in /opt/conda/lib/python3.7/site-packages (from ipython&gt;=4.0.0; python_version &gt;= &#34;3.3&#34;-&gt;ipywidgets&gt;=7.0.0-&gt;witwidget) (4.4.1)
Requirement already satisfied: jedi&gt;=0.10 in /opt/conda/lib/python3.7/site-packages (from ipython&gt;=4.0.0; python_version &gt;= &#34;3.3&#34;-&gt;ipywidgets&gt;=7.0.0-&gt;witwidget) (0.14.1)
Requirement already satisfied: backcall in /opt/conda/lib/python3.7/site-packages (from ipython&gt;=4.0.0; python_version &gt;= &#34;3.3&#34;-&gt;ipywidgets&gt;=7.0.0-&gt;witwidget) (0.1.0)
Requirement already satisfied: pickleshare in /opt/conda/lib/python3.7/site-packages (from ipython&gt;=4.0.0; python_version &gt;= &#34;3.3&#34;-&gt;ipywidgets&gt;=7.0.0-&gt;witwidget) (0.7.5)
Requirement already satisfied: importlib-metadata; python_version &lt; &#34;3.8&#34; in /opt/conda/lib/python3.7/site-packages (from markdown&gt;=2.6.8-&gt;tensorboard~=2.4-&gt;tensorflow&gt;=1.12.1-&gt;witwidget) (1.5.0)
Requirement already satisfied: certifi&gt;=2017.4.17 in /opt/conda/lib/python3.7/site-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard~=2.4-&gt;tensorflow&gt;=1.12.1-&gt;witwidget) (2019.11.28)
Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1 in /opt/conda/lib/python3.7/site-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard~=2.4-&gt;tensorflow&gt;=1.12.1-&gt;witwidget) (1.25.8)
Requirement already satisfied: chardet&lt;3.1.0,&gt;=3.0.2 in /opt/conda/lib/python3.7/site-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard~=2.4-&gt;tensorflow&gt;=1.12.1-&gt;witwidget) (3.0.4)
Requirement already satisfied: idna&lt;2.9,&gt;=2.5 in /opt/conda/lib/python3.7/site-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard~=2.4-&gt;tensorflow&gt;=1.12.1-&gt;witwidget) (2.8)
Requirement already satisfied: requests-oauthlib&gt;=0.7.0 in /opt/conda/lib/python3.7/site-packages (from google-auth-oauthlib&lt;0.5,&gt;=0.4.1-&gt;tensorboard~=2.4-&gt;tensorflow&gt;=1.12.1-&gt;witwidget) (1.3.0)
Requirement already satisfied: python-dateutil&gt;=2.1 in /opt/conda/lib/python3.7/site-packages (from jupyter-client&gt;=4.1-&gt;qtconsole-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (2.8.1)
Requirement already satisfied: webencodings in /opt/conda/lib/python3.7/site-packages (from bleach-&gt;nbconvert-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (0.5.1)
Requirement already satisfied: MarkupSafe&gt;=0.23 in /opt/conda/lib/python3.7/site-packages (from jinja2&gt;=2.4-&gt;nbconvert-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (1.1.1)
Requirement already satisfied: wcwidth in /opt/conda/lib/python3.7/site-packages (from prompt-toolkit!=3.0.0,!=3.0.1,&lt;3.1.0,&gt;=2.0.0-&gt;jupyter-console-&gt;jupyter&lt;2,&gt;=1.0-&gt;witwidget) (0.1.8)
Requirement already satisfied: attrs&gt;=17.4.0 in /opt/conda/lib/python3.7/site-packages (from jsonschema!=2.5.0,&gt;=2.4-&gt;nbformat&gt;=4.2.0-&gt;ipywidgets&gt;=7.0.0-&gt;witwidget) (19.3.0)
Requirement already satisfied: pyrsistent&gt;=0.14.0 in /opt/conda/lib/python3.7/site-packages (from jsonschema!=2.5.0,&gt;=2.4-&gt;nbformat&gt;=4.2.0-&gt;ipywidgets&gt;=7.0.0-&gt;witwidget) (0.15.7)
Requirement already satisfied: ptyprocess&gt;=0.5 in /opt/conda/lib/python3.7/site-packages (from pexpect; sys_platform != &#34;win32&#34;-&gt;ipython&gt;=4.0.0; python_version &gt;= &#34;3.3&#34;-&gt;ipywidgets&gt;=7.0.0-&gt;witwidget) (0.6.0)
Requirement already satisfied: parso&gt;=0.5.0 in /opt/conda/lib/python3.7/site-packages (from jedi&gt;=0.10-&gt;ipython&gt;=4.0.0; python_version &gt;= &#34;3.3&#34;-&gt;ipywidgets&gt;=7.0.0-&gt;witwidget) (0.5.2)
Requirement already satisfied: zipp&gt;=0.5 in /opt/conda/lib/python3.7/site-packages (from importlib-metadata; python_version &lt; &#34;3.8&#34;-&gt;markdown&gt;=2.6.8-&gt;tensorboard~=2.4-&gt;tensorflow&gt;=1.12.1-&gt;witwidget) (2.2.0)
Requirement already satisfied: oauthlib&gt;=3.0.0 in /opt/conda/lib/python3.7/site-packages (from requests-oauthlib&gt;=0.7.0-&gt;google-auth-oauthlib&lt;0.5,&gt;=0.4.1-&gt;tensorboard~=2.4-&gt;tensorflow&gt;=1.12.1-&gt;witwidget) (3.1.0)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Install-ndoejs-via-conda">Install ndoejs via conda<a class="anchor-link" href="#Install-ndoejs-via-conda"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>conda install nodejs --yes
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Collecting package metadata (current_repodata.json): done
Solving environment: done

# All requested packages already installed.

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Extensions-for-widgets">Extensions for widgets<a class="anchor-link" href="#Extensions-for-widgets"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>jupyter nbextension install --py --symlink --sys-prefix witwidget
<span class="o">!</span>jupyter nbextension <span class="nb">enable</span> --py --sys-prefix witwidget
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2021-01-04 04:48:30.158764: W tensorflow/stream_executor/platform/default/dso_loader.cc:60] Could not load dynamic library &#39;libcudart.so.11.0&#39;; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory
2021-01-04 04:48:30.158802: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.
Installing /opt/conda/lib/python3.7/site-packages/witwidget/static -&gt; wit-widget
- Validating: <span class="ansi-green-fg">OK</span>

    To initialize this nbextension in the browser every time the notebook (or other app) loads:
    
          jupyter nbextension enable witwidget --py --sys-prefix
    
2021-01-04 04:48:35.959057: W tensorflow/stream_executor/platform/default/dso_loader.cc:60] Could not load dynamic library &#39;libcudart.so.11.0&#39;; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory
2021-01-04 04:48:35.959097: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.
Enabling notebook extension wit-widget/extension...
      - Validating: <span class="ansi-green-fg">OK</span>
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>jupyter labextension install wit-widget
<span class="o">!</span>jupyter labextension install jupyter-widgets/jupyterlab-manager --yes
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Building jupyterlab assets (build:prod:minimize)
Install labextension(s)

 Usage

    jupyter labextension install [--pin-version-as &lt;alias,...&gt;] &lt;package...&gt;

This installs JupyterLab extensions similar to yarn add or npm install.

Pass a list of comma seperate names to the --pin-version-as flag to use as
alises for the packages providers. This is useful to install multiple versions
of the same extension. These can be uninstalled with the alias you provided to
the flag, similar to the &#34;alias&#34; feature of yarn add.

Options
-------

Arguments that take values are actually convenience aliases to full
Configurables, whose aliases are listed on the help line. For more information
on full configurables, see &#39;--help-all&#39;.

--debug
    set log level to logging.DEBUG (maximize logging output)
--generate-config
    generate default config file
-y
    Answer yes to any questions instead of prompting.
--no-build
    Defer building the app after the action.
--clean
    Cleanup intermediate files after the action.
--log-level=&lt;Enum&gt; (Application.log_level)
    Default: 30
    Choices: (0, 10, 20, 30, 40, 50, &#39;DEBUG&#39;, &#39;INFO&#39;, &#39;WARN&#39;, &#39;ERROR&#39;, &#39;CRITICAL&#39;)
    Set the log level by value or name.
--config=&lt;Unicode&gt; (JupyterApp.config_file)
    Default: &#39;&#39;
    Full path of a config file.
--app-dir=&lt;Unicode&gt; (BaseExtensionApp.app_dir)
    Default: &#39;&#39;
    The app directory to target
--dev-build=&lt;Bool&gt; (BaseExtensionApp.dev_build)
    Default: None
    Whether to build in dev mode. Defaults to True (dev mode) if there are any
    locally linked extensions, else defaults to False (prod mode).
--minimize=&lt;Bool&gt; (BaseExtensionApp.minimize)
    Default: True
    Whether to use a minifier during the Webpack build (defaults to True). Only
    affects production builds.
--debug-log-path=&lt;Unicode&gt; (DebugLogFileMixin.debug_log_path)
    Default: &#39;&#39;
    Path to use for the debug log file
--pin-version-as=&lt;Unicode&gt; (InstallLabExtensionApp.pin)
    Default: &#39;&#39;
    Pin this version with a certain alias

To see all available configurables, use `--help-all`

Bad config encountered during initialization:
Unrecognized flag: &#39;--yes&#39;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Imports">Imports<a class="anchor-link" href="#Imports"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">witwidget.notebook.visualization</span> <span class="kn">import</span> <span class="n">WitWidget</span><span class="p">,</span> <span class="n">WitConfigBuilder</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Already-Build-Model">Already Build Model<a class="anchor-link" href="#Already-Build-Model"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">PROJECT_ID</span> <span class="o">=</span> <span class="s1">&#39;YOUR_PROJECT_ID&#39;</span>
<span class="n">MODEL_NAME</span> <span class="o">=</span> <span class="s1">&#39;YOUR_MODEL_NAME&#39;</span>
<span class="n">VERSION_NAME</span> <span class="o">=</span> <span class="s1">&#39;YOUR_VERSION_NAME&#39;</span>
<span class="n">TARGET_FEATURE</span> <span class="o">=</span> <span class="s1">&#39;mortgage_status&#39;</span>
<span class="n">LABEL_VOCAB</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;denied&#39;</span><span class="p">,</span> <span class="s1">&#39;approved&#39;</span><span class="p">]</span>

<span class="n">config_builder</span> <span class="o">=</span> <span class="p">(</span><span class="n">WitConfigBuilder</span><span class="p">(</span><span class="n">test_examples</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;mortgage_status&#39;</span><span class="p">])</span>
  <span class="o">.</span><span class="n">set_ai_platform_model</span><span class="p">(</span><span class="n">PROJECT_ID</span><span class="p">,</span> <span class="n">MODEL_NAME</span><span class="p">,</span> <span class="n">VERSION_NAME</span><span class="p">,</span> <span class="n">adjust_prediction</span><span class="o">=</span><span class="n">adjust_prediction</span><span class="p">)</span>
  <span class="o">.</span><span class="n">set_target_feature</span><span class="p">(</span><span class="n">TARGET_FEATURE</span><span class="p">)</span>
  <span class="o">.</span><span class="n">set_label_vocab</span><span class="p">(</span><span class="n">LABEL_VOCAB</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">WitWidget</span><span class="p">(</span><span class="n">config_builder</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Define-Helper-function">Define Helper function<a class="anchor-link" href="#Define-Helper-function"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">functools</span>

<span class="c1"># Creates a tf feature spec from the dataframe and columns specified.</span>
<span class="k">def</span> <span class="nf">create_feature_spec</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">feature_spec</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">columns</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span> <span class="ow">or</span> <span class="n">df</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">):</span>
            <span class="n">feature_spec</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">FixedLenFeature</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">df</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">):</span>
            <span class="n">feature_spec</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">FixedLenFeature</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feature_spec</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">FixedLenFeature</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">feature_spec</span>

<span class="c1"># Creates simple numeric and categorical feature columns from a feature spec and a</span>
<span class="c1"># list of columns from that spec to use.</span>
<span class="c1">#</span>
<span class="c1"># NOTE: Models might perform better with some feature engineering such as bucketed</span>
<span class="c1"># numeric columns and hash-bucket/embedding columns for categorical features.</span>
<span class="k">def</span> <span class="nf">create_feature_columns</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">feature_spec</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">feature_spec</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="n">tf</span><span class="o">.</span><span class="n">int64</span> <span class="ow">or</span> <span class="n">feature_spec</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">feature_column</span><span class="o">.</span><span class="n">numeric_column</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">feature_column</span><span class="o">.</span><span class="n">indicator_column</span><span class="p">(</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">feature_column</span><span class="o">.</span><span class="n">categorical_column_with_vocabulary_list</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))))</span>
    <span class="k">return</span> <span class="n">ret</span>

<span class="c1"># An input function for providing input to a model from tf.Examples</span>
<span class="k">def</span> <span class="nf">tfexamples_input_fn</span><span class="p">(</span><span class="n">examples</span><span class="p">,</span> <span class="n">feature_spec</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">ModeKeys</span><span class="o">.</span><span class="n">EVAL</span><span class="p">,</span>
                       <span class="n">num_epochs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                       <span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">ex_generator</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">examples</span><span class="p">)):</span>
            <span class="k">yield</span> <span class="n">examples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">()</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_generator</span><span class="p">(</span>
      <span class="n">ex_generator</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([]))</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">tf</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">ModeKeys</span><span class="o">.</span><span class="n">TRAIN</span><span class="p">:</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">buffer_size</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">batch_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">tf_example</span><span class="p">:</span> <span class="n">parse_tf_example</span><span class="p">(</span><span class="n">tf_example</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">feature_spec</span><span class="p">))</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dataset</span>

<span class="c1"># Parses Tf.Example protos into features for the input function.</span>
<span class="k">def</span> <span class="nf">parse_tf_example</span><span class="p">(</span><span class="n">example_proto</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">feature_spec</span><span class="p">):</span>
    <span class="n">parsed_features</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">parse_example</span><span class="p">(</span><span class="n">serialized</span><span class="o">=</span><span class="n">example_proto</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">feature_spec</span><span class="p">)</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">parsed_features</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parsed_features</span><span class="p">,</span> <span class="n">target</span>

<span class="c1"># Converts a dataframe into a list of tf.Example protos.</span>
<span class="k">def</span> <span class="nf">df_to_examples</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">examples</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">columns</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">example</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Example</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span> <span class="ow">or</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">):</span>
                <span class="n">example</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">int64_list</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">):</span>
                <span class="n">example</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">float_list</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]:</span>
                <span class="n">example</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">bytes_list</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">examples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">examples</span>

<span class="c1"># Converts a dataframe column into a column of 0&#39;s and 1&#39;s based on the provided test.</span>
<span class="c1"># Used to force label columns to be numeric for binary classification using a TF estimator.</span>
<span class="k">def</span> <span class="nf">make_label_column_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">label_column</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
  <span class="n">df</span><span class="p">[</span><span class="n">label_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">test</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">label_column</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Read-training-dataset-and-stored-in-df">Read training dataset and stored in df<a class="anchor-link" href="#Read-training-dataset-and-stored-in-df"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">sagemaker</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="n">s3_bucket</span> <span class="o">=</span> <span class="n">sagemaker</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">default_bucket</span><span class="p">()</span>
<span class="n">s3_prefix</span> <span class="o">=</span> <span class="s1">&#39;heidelberg/data&#39;</span>
<span class="n">s3_filename</span> <span class="o">=</span> <span class="s2">&quot;transformed.csv&quot;</span>



<span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">s3_bucket</span><span class="p">,</span> <span class="n">s3_prefix</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">s3_filename</span><span class="p">)</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="s1">&#39;Body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">body</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Specify-input-columns-and-column-to-predict">Specify input columns and column to predict<a class="anchor-link" href="#Specify-input-columns-and-column-to-predict"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">features</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Set the column in the dataset you wish for the model to predict</span>
<span class="n">label_column</span> <span class="o">=</span> <span class="s1">&#39;target&#39;</span>

<span class="c1"># Set list of all columns from the dataset we will use for model input.</span>
<span class="n">input_features</span> <span class="o">=</span> <span class="n">features</span>

<span class="c1"># Create a list containing all input features and the label column</span>
<span class="n">features_and_labels</span> <span class="o">=</span> <span class="n">input_features</span> <span class="o">+</span> <span class="p">[</span><span class="n">label_column</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Convert-dataset-to-tf.Example-protos">Convert dataset to tf.Example protos<a class="anchor-link" href="#Convert-dataset-to-tf.Example-protos"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">examples</span> <span class="o">=</span> <span class="n">df_to_examples</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Create-and-Train-the-Regressor">Create and Train the Regressor<a class="anchor-link" href="#Create-and-Train-the-Regressor"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">num_steps</span> <span class="o">=</span> <span class="mi">200</span>  <span class="c1">#@param {type: &quot;number&quot;}</span>

<span class="c1"># Create a feature spec for the classifier</span>
<span class="n">feature_spec</span> <span class="o">=</span> <span class="n">create_feature_spec</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">features_and_labels</span><span class="p">)</span>

<span class="c1"># Define and train the classifier</span>
<span class="n">train_inpf</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">tfexamples_input_fn</span><span class="p">,</span> <span class="n">examples</span><span class="p">,</span> <span class="n">feature_spec</span><span class="p">,</span> <span class="n">label_column</span><span class="p">)</span>
<span class="n">regressor</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">LinearRegressor</span><span class="p">(</span>
    <span class="n">feature_columns</span><span class="o">=</span><span class="n">create_feature_columns</span><span class="p">(</span><span class="n">input_features</span><span class="p">,</span> <span class="n">feature_spec</span><span class="p">))</span>
<span class="n">regressor</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_inpf</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">num_steps</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>INFO:tensorflow:Using default config.
WARNING:tensorflow:Using temporary folder as model directory: /tmp/tmpv78wrrdi
INFO:tensorflow:Using config: {&#39;_model_dir&#39;: &#39;/tmp/tmpv78wrrdi&#39;, &#39;_tf_random_seed&#39;: None, &#39;_save_summary_steps&#39;: 100, &#39;_save_checkpoints_steps&#39;: None, &#39;_save_checkpoints_secs&#39;: 600, &#39;_session_config&#39;: allow_soft_placement: true
graph_options {
  rewrite_options {
    meta_optimizer_iterations: ONE
  }
}
, &#39;_keep_checkpoint_max&#39;: 5, &#39;_keep_checkpoint_every_n_hours&#39;: 10000, &#39;_log_step_count_steps&#39;: 100, &#39;_train_distribute&#39;: None, &#39;_device_fn&#39;: None, &#39;_protocol&#39;: None, &#39;_eval_distribute&#39;: None, &#39;_experimental_distribute&#39;: None, &#39;_experimental_max_worker_delay_secs&#39;: None, &#39;_session_creation_timeout_secs&#39;: 7200, &#39;_checkpoint_save_graph_def&#39;: True, &#39;_service&#39;: None, &#39;_cluster_spec&#39;: ClusterSpec({}), &#39;_task_type&#39;: &#39;worker&#39;, &#39;_task_id&#39;: 0, &#39;_global_id_in_cluster&#39;: 0, &#39;_master&#39;: &#39;&#39;, &#39;_evaluation_master&#39;: &#39;&#39;, &#39;_is_chief&#39;: True, &#39;_num_ps_replicas&#39;: 0, &#39;_num_worker_replicas&#39;: 1}
WARNING:tensorflow:From /opt/conda/lib/python3.7/site-packages/tensorflow/python/training/training_util.py:236: Variable.initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
WARNING:tensorflow:From &lt;ipython-input-5-471492688c87&gt;:45: calling DatasetV2.from_generator (from tensorflow.python.data.ops.dataset_ops) with output_types is deprecated and will be removed in a future version.
Instructions for updating:
Use output_signature instead
WARNING:tensorflow:From &lt;ipython-input-5-471492688c87&gt;:45: calling DatasetV2.from_generator (from tensorflow.python.data.ops.dataset_ops) with output_shapes is deprecated and will be removed in a future version.
Instructions for updating:
Use output_signature instead
INFO:tensorflow:Calling model_fn.
WARNING:tensorflow:From /opt/conda/lib/python3.7/site-packages/tensorflow/python/keras/optimizer_v2/ftrl.py:134: calling Constant.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
INFO:tensorflow:Done calling model_fn.
INFO:tensorflow:Create CheckpointSaverHook.
INFO:tensorflow:Graph was finalized.
INFO:tensorflow:Running local_init_op.
INFO:tensorflow:Done running local_init_op.
INFO:tensorflow:Calling checkpoint listeners before saving checkpoint 0...
INFO:tensorflow:Saving checkpoints for 0 into /tmp/tmpv78wrrdi/model.ckpt.
INFO:tensorflow:Calling checkpoint listeners after saving checkpoint 0...
INFO:tensorflow:loss = 3.2560234, step = 0
INFO:tensorflow:global_step/sec: 30.0161
INFO:tensorflow:loss = 0.7137667, step = 100 (3.332 sec)
INFO:tensorflow:Calling checkpoint listeners before saving checkpoint 200...
INFO:tensorflow:Saving checkpoints for 200 into /tmp/tmpv78wrrdi/model.ckpt.
INFO:tensorflow:Calling checkpoint listeners after saving checkpoint 200...
INFO:tensorflow:Loss for final step: 0.87051874.
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;tensorflow_estimator.python.estimator.canned.linear.LinearRegressorV2 at 0x7f30b4576990&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Invoke-What-If-Tool-for-test-data-and-the-trained-model">Invoke What-If Tool for test data and the trained model<a class="anchor-link" href="#Invoke-What-If-Tool-for-test-data-and-the-trained-model"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">num_datapoints</span> <span class="o">=</span> <span class="mi">2000</span>  <span class="c1">#@param {type: &quot;number&quot;}</span>
<span class="n">tool_height_in_px</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1">#@param {type: &quot;number&quot;}</span>

<span class="kn">from</span> <span class="nn">witwidget.notebook.visualization</span> <span class="kn">import</span> <span class="n">WitConfigBuilder</span>
<span class="kn">from</span> <span class="nn">witwidget.notebook.visualization</span> <span class="kn">import</span> <span class="n">WitWidget</span>

<span class="c1"># Load up the test dataset</span>


<span class="c1"># test_csv_path = &#39;https://archive.ics.uci.edu/ml/machine-learning-databases/adult/adult.test&#39;</span>
<span class="c1"># test_df = pd.read_csv(test_csv_path, names=csv_columns, skipinitialspace=True,</span>
<span class="c1">#   skiprows=1)</span>
<span class="n">test_examples</span> <span class="o">=</span> <span class="n">df_to_examples</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">num_datapoints</span><span class="p">])</span>

<span class="c1"># Setup the tool with the test examples and the trained classifier</span>
<span class="n">config_builder</span> <span class="o">=</span> <span class="n">WitConfigBuilder</span><span class="p">(</span><span class="n">test_examples</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">num_datapoints</span><span class="p">])</span><span class="o">.</span><span class="n">set_estimator_and_feature_spec</span><span class="p">(</span>
    <span class="n">regressor</span><span class="p">,</span> <span class="n">feature_spec</span><span class="p">)</span><span class="o">.</span><span class="n">set_model_type</span><span class="p">(</span><span class="s1">&#39;regression&#39;</span><span class="p">)</span>
<span class="n">WitWidget</span><span class="p">(</span><span class="n">config_builder</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">tool_height_in_px</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Exploration-ideas">Exploration ideas<a class="anchor-link" href="#Exploration-ideas"> </a></h4><ul>
<li><p>Create a scatter plot of age on the X-axis by inference value on the Y-axis to see how the predicted age compares to the actual age for all test examples.</p>
<ul>
<li>How does the model do overall? Is there a pattern to the errors it creates?</li>
</ul>
</li>
<li><p>In the "Performance" tab, set the ground truth feature to "age". You can now see a simple breakdown of the mean error, mean absolute error, and mean squared error over the entire test set. Additionally, you can set a scatter axis or binning option to be any of those three calculations (i.e. you can make a scatter plot of age vs inference error).</p>
</li>
<li><p>Replace the LinearRegressor with a DNNRegressor (you'll need to decide on the size and number of the hidden layers). Can you create a better model? Does this model have the same pattern of performance issues as the previous model, or are there errors more evenly distributed?</p>
<ul>
<li>If you look at the <a href="https://colab.research.google.com/github/pair-code/what-if-tool/blob/master/WIT_Model_Comparison.ipynb">WIT Model Comparison</a> notebook, you can see how to compare the two models on a single WIT.</li>
</ul>
</li>
<li><p>In the "Performance" tab, slice the dataset by any feature or pair of features. Are there feature values for which the model seems to perform better or worse on?</p>
</li>
</ul>

</div>
</div>
</div>
</div>
 

